<mvc:View controllerName="iifcl.cml.cmlmisapp.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:l="sap.ui.layout"
    xmlns:f="sap.f"
    xmlns:card="sap.f.cards"
    xmlns:core="sap.ui.core"  
    xmlns:viz="sap.viz.ui5.controls"
    xmlns:vizData="sap.viz.ui5.data"
    xmlns:vizFeeds="sap.viz.ui5.controls.common.feeds">

    <App id="mainapp">
        <Page id="rootPage" title="CML MIS Analytics Workbench" class="appBackground" showHeader="true">
            <content>
                <HBox id="MainLayoutHBox" width="100%" height="100%" renderType="Bare" fitContainer="true">

                    <VBox id="SidebarBox" 
                          width="{= ${view>/sidebarCollapsed} ? '0px' : '260px' }" 
                          visible="{= !${view>/sidebarCollapsed} }" 
                          class="customSidebar sapUiSmallBorderRight">
                        
                        <Title id="_IDGenTitle" text="MIS Reports" level="H3" class="sapUiMediumMarginTop sapUiSmallMarginBegin sapUiSmallMarginBottom"/>
                        
                        <List id="reportList" 
                              mode="SingleSelectMaster" 
                              items="{reports>/reports}" 
                              selectionChange=".onReportSelect" 
                              backgroundDesign="Transparent"
                              showSeparators="None">
                            <StandardListItem id="_IDGenStandardListItem" title="{reports>title}" 
                                              description="{reports>id}" 
                                              type="Active" 
                                              icon="sap-icon://chart-vertical-bar"
                                              class="customListItem"/>
                        </List>
                    </VBox>

                    <VBox id="ContentBox" width="100%" class="sapUiSmallMarginBegin sapUiSmallMarginEnd">

                        <HBox id="_IDGenHBox" alignItems="Center" justifyContent="SpaceBetween" class="sapUiSmallMarginTop sapUiTinyMarginBottom">
                            <Title id="_IDGenTitle1" text="{view>/currentReportTitle}" level="H2" class="pageTitle"/>
                            <Button id="_IDGenButton" icon="{= ${view>/sidebarCollapsed} ? 'sap-icon://expand-group' : 'sap-icon://collapse-group' }" 
                                    press=".onToggleSidebar" type="Transparent"/>
                        </HBox>

                        <IconTabBar id="tabBar" expandable="false" class="sapUiNoContentPadding" expanded="true">
                            <items>
                                <IconTabFilter id="_IDGenIconTabFilter" key="data" text="Data Table" icon="sap-icon://table-view">
                                    <VBox id="_IDGenVBox" class="sapUiMediumMarginTop">
                                        <Table id="dataTable" items="{view>/rows}" class="customCard">
                                            <headerToolbar>
                                                <OverflowToolbar id="_IDGenOverflowToolbar">
                                                    <Title id="_IDGenTitle2" text="Detailed Records" level="H4"/>
                                                    <ToolbarSpacer id="_IDGenToolbarSpacer"/>
                                                    <Text id="_IDGenText" text="{view>/activeBucketLabel} | {view>/activeMetricLabel}" class="sapUiTinyMarginEnd subtleText"/>
                                                </OverflowToolbar>
                                            </headerToolbar>
                                            <columns>
                                                <Column id="_IDGenColumn"><Text id="_IDGenText1" text="{view>/col1Header}" /></Column>
                                                <Column id="_IDGenColumn1"><Text id="_IDGenText2" text="{view>/col2Header}" /></Column>
                                                <Column id="_IDGenColumn2" visible="{view>/showCol3}"><Text id="_IDGenText3" text="{view>/col3Header}" /></Column>
                                                <Column id="_IDGenColumn3" hAlign="End"><Text id="_IDGenText4" text="Projects (CY)" /></Column>
                                                <Column id="_IDGenColumn4" hAlign="End"><Text id="_IDGenText5" text="Proj. Cost (CY)" /></Column>
                                                <Column id="_IDGenColumn5" hAlign="End"><Text id="_IDGenText6" text="{view>/measureLabel}" /></Column>
                                            </columns>
                                            <items>
                                                <ColumnListItem id="_IDGenColumnListItem">
                                                    <cells>
                                                        <Text id="_IDGenText7" text="{= ${view>Scheme} || ${view>SectorName} }" />
                                                        <Text id="_IDGenText8" text="{= ${view>BorrowerGroup} || ${view>SubSectorName} }" />
                                                        <Text id="_IDGenText9" text="{view>BorrowerGroupName}" visible="{view>/showCol3}" />
                                                        <ObjectNumber id="_IDGenObjectNumber" number="{path: 'view>ProjectsCY', formatter: '.formatter.projects'}" />
                                                        <ObjectNumber id="_IDGenObjectNumber1" number="{path: 'view>ProjectCostCYUI', formatter: '.formatter.metric'}" unit="Cr" />
                                                        <ObjectNumber id="_IDGenObjectNumber2" number="{path: 'view>CurrentMetric', formatter: '.formatter.metric'}" unit="Cr" state="Information" />
                                                    </cells>
                                                </ColumnListItem>
                                            </items>
                                        </Table>
                                    </VBox>
                                </IconTabFilter>

                                <IconTabFilter id="_IDGenIconTabFilter1" key="analytics" text="Dashboard" icon="sap-icon://bar-chart">
                                    <ScrollContainer id="_IDGenScrollContainer" width="100%" height="100%" horizontal="false" vertical="true">
                                        <VBox id="_IDGenVBox1" class="sapUiSmallMarginTop sapUiSmallMarginBottom" width="100%">

                                            <HBox id="_IDGenHBox1" width="100%" class="sapUiSmallMarginBottom">
                                                <f:Card id="_IDGenCard1" class="sapUiSmallMarginEnd kpiCard" width="300px">
                                                    <f:content>
                                                        <VBox id="_IDGenVBox2" class="sapUiSmallMargin">
                                                            <Title id="_IDGenTitle3" text="Total Projects (CY)" level="H5" class="subtleTitle"/>
                                                            <ObjectNumber id="_IDGenObjectNumber3" number="{view>/totalProjects}" class="bigKpiNumber" state="Success"/>
                                                        </VBox>
                                                    </f:content>
                                                </f:Card>
                                                
                                                <f:Card id="_IDGenCard2" class="kpiCard" width="300px">
                                                    <f:content>
                                                        <VBox id="_IDGenVBox3" class="sapUiSmallMargin">
                                                            <Title id="_IDGenTitle4" text="{view>/measureLabel}" level="H5" class="subtleTitle"/>
                                                            <ObjectNumber id="_IDGenObjectNumber4" number="{view>/totalMetric}" unit="Cr" class="bigKpiNumber" state="Information"/>
                                                        </VBox>
                                                    </f:content>
                                                </f:Card>
                                            </HBox>

                                            <f:Card id="_IDGenCard3" class="sapUiSmallMarginBottom filterBarCard" width="100%">
                                                <f:content>
                                                    <OverflowToolbar id="_IDGenOverflowToolbar1" design="Transparent" class="sapUiTinyMargin">
                                                        <Label id="_IDGenLabel" text="Period:" design="Bold"/>
                                                        <SegmentedButton id="_IDGenSegmentedButton" selectedKey="{view>/selectedBucketKey}" selectionChange=".onBucketToggle">
                                                            <items>
                                                                <SegmentedButtonItem id="_IDGenSegmentedButtonItem" key="CY" text="Apr–Nov 2025" />
                                                                <SegmentedButtonItem id="_IDGenSegmentedButtonItem1" key="PY" text="Apr 24–Mar 25" />
                                                            </items>
                                                        </SegmentedButton>
                                                        
                                                        <ToolbarSpacer id="_IDGenToolbarSpacer1"/>
                                                        
                                                        <Label id="_IDGenLabel1" text="Metric:" design="Bold" class="sapUiSmallMarginBegin"/>
                                                        <SegmentedButton id="_IDGenSegmentedButton1" selectedKey="{view>/selectedMetricKey}" selectionChange=".onMetricToggle">
                                                            <items>
                                                                <SegmentedButtonItem id="_IDGenSegmentedButtonItem2" key="gross" text="Gross Sanc." />
                                                                <SegmentedButtonItem id="_IDGenSegmentedButtonItem3" key="disb"  text="Disbursement" />
                                                                <SegmentedButtonItem id="_IDGenSegmentedButtonItem4" key="net"   text="Net Sanc." />
                                                                <SegmentedButtonItem id="_IDGenSegmentedButtonItem5" key="os"    text="Principal O/S" />
                                                                <SegmentedButtonItem id="_IDGenSegmentedButtonItem6" key="cost"  text="Proj. Cost" />
                                                            </items>
                                                        </SegmentedButton>
                                                    </OverflowToolbar>
                                                </f:content>
                                            </f:Card>

                                            <l:Grid id="_IDGenGrid" defaultSpan="L6 M12 S12" hSpacing="1" vSpacing="1">
                                                <l:content>
                                                    <f:Card id="_IDGenCard4" class="chartCard" width="100%">
                                                        <f:header>
                                                            <card:Header id="_IDGenHeader" title="Trend by Group / Sector" iconSrc="sap-icon://vertical-bar-chart" />
                                                        </f:header>
                                                        <f:content>
                                                            <viz:VizFrame id="devGroupChart" uiConfig="{applicationSet:'fiori'}" vizType="column" width="100%" height="320px">
                                                                <viz:dataset>
                                                                    <vizData:FlattenedDataset id="_IDGenFlattenedDataset" data="{view>/rows}">
                                                                        <vizData:dimensions>
                                                                            <vizData:DimensionDefinition id="_IDGenDimensionDefinition" name="Group / Sector" value="{view>GenericDim}" />
                                                                        </vizData:dimensions>
                                                                        <vizData:measures>
                                                                            <vizData:MeasureDefinition id="_IDGenMeasureDefinition" name="Metric" value="{view>CurrentMetric}" />
                                                                        </vizData:measures>
                                                                    </vizData:FlattenedDataset>
                                                                </viz:dataset>
                                                                <viz:feeds>
                                                                    <vizFeeds:FeedItem id="_IDGenFeedItem" uid="categoryAxis" type="Dimension" values="Group / Sector" />
                                                                    <vizFeeds:FeedItem id="_IDGenFeedItem1" uid="valueAxis" type="Measure" values="Metric" />
                                                                </viz:feeds>
                                                            </viz:VizFrame>
                                                        </f:content>
                                                    </f:Card>

                                                    <f:Card id="_IDGenCard5" class="chartCard" width="100%">
                                                        <f:header>
                                                            <card:Header id="_IDGenHeader1" title="Share across Groups" iconSrc="sap-icon://donut-chart" />
                                                        </f:header>
                                                        <f:content>
                                                            <viz:VizFrame id="shareChart" uiConfig="{applicationSet:'fiori'}" vizType="donut" width="100%" height="320px">
                                                                <viz:dataset>
                                                                    <vizData:FlattenedDataset id="_IDGenFlattenedDataset1" data="{view>/rows}">
                                                                        <vizData:dimensions>
                                                                            <vizData:DimensionDefinition id="_IDGenDimensionDefinition1" name="Group / Sector" value="{view>GenericDim}" />
                                                                        </vizData:dimensions>
                                                                        <vizData:measures>
                                                                            <vizData:MeasureDefinition id="_IDGenMeasureDefinition1" name="Metric" value="{view>CurrentMetric}" />
                                                                        </vizData:measures>
                                                                    </vizData:FlattenedDataset>
                                                                </viz:dataset>
                                                                <viz:feeds>
                                                                    <vizFeeds:FeedItem id="_IDGenFeedItem2" uid="size" type="Measure" values="Metric" />
                                                                    <vizFeeds:FeedItem id="_IDGenFeedItem3" uid="color" type="Dimension" values="Group / Sector" />
                                                                </viz:feeds>
                                                            </viz:VizFrame>
                                                        </f:content>
                                                    </f:Card>

                                                </l:content>
                                            </l:Grid>

                                        </VBox>
                                        
                                    </ScrollContainer>
                                </IconTabFilter>
                            </items>
                            <IconTabFilter id="_IDGenIconTabFilter3" key="geo" text="Geo Map" icon="sap-icon://map" visible="{= ${view>/isGeoReport} }">
        <HBox id="_IDGenHBox2" width="100%" height="600px" alignItems="Start" class="sapUiMediumMarginTop">
            
            <VBox id="_IDGenVBox4" width="60%" height="100%" class="sapUiMediumMarginEnd mapBox">
                <core:HTML id="_IDGenHTML" content='&lt;div id="indiaMapContainer" style="width:100%; height:100%;"&gt;&lt;/div&gt;' />
            </VBox>

            <VBox id="_IDGenVBox5" width="40%">
                <f:Card id="_IDGenCard" width="100%" class="chartCard">
                    <f:header>
                        <card:Header id="_IDGenHeader2" title="Regional Distribution" subtitle="Loans by Zone" iconSrc="sap-icon://choropleth-chart"/>
                    </f:header>
                    <f:content>
                        <viz:VizFrame id="geoVizFrame" uiConfig="{applicationSet:'fiori'}" vizType="bar" width="100%" height="400px">
                             <viz:dataset>
                                <vizData:FlattenedDataset id="geoDataset" data="{geo>/items}">
                                    <vizData:dimensions>
                                        <vizData:DimensionDefinition id="_IDGenDimensionDefinition2" name="Zone" value="{geo>Zone}" />
                                    </vizData:dimensions>
                                    <vizData:measures>
                                        <vizData:MeasureDefinition id="_IDGenMeasureDefinition3" name="Value" value="{geo>Value}" />
                                    </vizData:measures>
                                </vizData:FlattenedDataset>
                            </viz:dataset>
                            <viz:feeds>
                                <vizFeeds:FeedItem id="_IDGenFeedItem4" uid="valueAxis" type="Measure" values="Value" />
                                <vizFeeds:FeedItem id="_IDGenFeedItem5" uid="categoryAxis" type="Dimension" values="Zone" />
                            </viz:feeds>
                        </viz:VizFrame>
                    </f:content>
                </f:Card>
            </VBox>
        </HBox>
    </IconTabFilter>
                        </IconTabBar>
                    </VBox>
                </HBox>
            </content>
        </Page>
    </App>
</mvc:View>