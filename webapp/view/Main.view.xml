<mvc:View controllerName="iifcl.cml.cmlmisapp.controller.Main"
    xmlns:mvc="sap.ui.core.mvc" xmlns="sap.m" xmlns:l="sap.ui.layout" xmlns:f="sap.f"
    xmlns:card="sap.f.cards" xmlns:core="sap.ui.core" xmlns:viz="sap.viz.ui5.controls"
    xmlns:vizData="sap.viz.ui5.data" xmlns:vizFeeds="sap.viz.ui5.controls.common.feeds"
    xmlns:fb="sap.ui.comp.filterbar">

    <App id="mainapp">
        <Page id="rootPage" showHeader="false" class="appBackground">
            <content>
                <HBox id="MainLayoutHBox" width="100%" height="100%" renderType="Bare" fitContainer="true">

                    <!-- SIDEBAR -->
                    <VBox id="SidebarBox" width="{= ${view>/sidebarCollapsed} ? '0px' : '280px' }" 
                          visible="{= !${view>/sidebarCollapsed} }" class="customSidebar">
                        <items>
                            <HBox id="_IDGenHBox" alignItems="Center" class="sapUiMediumMarginTop sapUiMediumMarginBegin sapUiSmallMarginBottom">
                                <core:Icon id="_IDGenIcon" src="sap-icon://bbyd-dashboard" size="1.5rem" color="white" class="sapUiTinyMarginEnd"/>
                                <Title id="_IDGenTitle" text="MIS WORKBENCH" level="H3" class="sidebarTitle"/>
                            </HBox>
                            <List id="_IDGenList" items="{reports>/reports}" mode="SingleSelectMaster" selectionChange=".onReportSelect" backgroundDesign="Transparent" showSeparators="None">
                                <StandardListItem id="_IDGenStandardListItem" title="{reports>title}" type="Active" icon="sap-icon://chart-vertical-bar" class="customListItem"/>
                            </List>
                        </items>
                    </VBox>

                    <!-- CONTENT AREA -->
                    <VBox id="ContentBox" width="100%" class="sapUiSmallMarginBegin sapUiSmallMarginEnd">
                        <layoutData>
        <FlexItemData growFactor="1" />
    </layoutData>
                        <items>
                            <!-- TOOLBAR -->
                            <OverflowToolbar id="_IDGenOverflowToolbar" class="customHeaderToolbar sapUiSmallMarginTop">
                                <Button id="_IDGenButton" icon="sap-icon://menu2" press=".onToggleSidebar" type="Transparent"/>
                                <Title id="_IDGenTitle1" text="{view>/currentReportTitle}" level="H2" class="pageTitle sapUiSmallMarginBegin"/>
                                <ToolbarSpacer id="_IDGenToolbarSpacer"/>
                                
                                <!-- Tenure Selector -->
                                <Label id="lblTenure" text="Tenure:" design="Bold" class="headerLabel sapUiSmallMarginBegin"/>
                                <Select id="tenureSelector" 
                                        change=".onTenureChange" 
                                        selectedKey="{view>/selectedTenure}" 
                                        width="120px"
                                        class="customSelect">
                                    <core:Item id="itmYearly" key="Yearly" text="Yearly"/>
                                    <core:Item id="itmHalf" key="HalfYearly" text="Half-Yearly"/>
                                    <core:Item id="itmQuarter" key="Quarterly" text="Quarterly"/>
                                    <core:Item id="itmMonth" key="Monthly" text="Monthly"/>
                                </Select>

                                <Label id="_IDGenLabel" text="Period:" design="Bold" class="headerLabel sapUiSmallMarginBegin"/>
                                <SegmentedButton id="periodSelector" 
                                    selectedKey="{view>/selectedBucketKey}" 
                                    selectionChange=".onBucketToggle" 
                                    class="customSegmented"
                                    enabled="{= !${view>/comparisonMode} }">
                                    <items>
                                        <SegmentedButtonItem id="_IDGenSegmentedButtonItem" key="CY" text="{view>/periodLabelCY}"/>
                                        <SegmentedButtonItem id="_IDGenSegmentedButtonItem1" key="PY" text="{view>/periodLabelPY}"/>
                                    </items>
                                </SegmentedButton>

                                <Label id="_IDGenLabel1" text="Metric:" design="Bold" class="headerLabel sapUiSmallMarginBegin"/>
                                <SegmentedButton id="_IDGenSegmentedButton1" selectedKey="{view>/selectedMetricKey}" selectionChange=".onMetricToggle" class="customSegmented">
                                    <items>
                                        <SegmentedButtonItem id="_IDGenSegmentedButtonItem2" key="gross" text="Gross"/>
                                        <SegmentedButtonItem id="_IDGenSegmentedButtonItem3" key="disb" text="Disb."/>
                                        <SegmentedButtonItem id="_IDGenSegmentedButtonItem4" key="net" text="Net"/>
                                        <SegmentedButtonItem id="_IDGenSegmentedButtonItem5" key="os" text="O/S"/>
                                    </items>
                                </SegmentedButton>

                                <!-- Comparison Toggle Button -->
                                <ToolbarSeparator id="_IDGenToolbarSeparator"/>
                                <ToggleButton id="comparisonToggle"
                                    text="Compare CY vs PY"
                                    icon="sap-icon://compare"
                                    pressed="{view>/comparisonMode}"
                                    press=".onComparisonToggle"
                                    type="Emphasized"/>

                                    <Button id="btnExport"
    icon="sap-icon://excel-attachment"
    tooltip="Export to Excel"
    press=".onExport"
    type="Transparent"/>
                            </OverflowToolbar>

                            <!-- INFO STRIP -->
                            <HBox id="_IDGenHBox1" width="100%" justifyContent="SpaceBetween" alignItems="Center" class="sapUiSmallMarginTop sapUiTinyMarginBottom">
                                <items>
                                    <HBox id="_IDGenHBox2" alignItems="Center" wrap="Wrap">
                                        <core:Icon id="_IDGenIcon1" src="sap-icon://calendar" size="1rem" color="#3182ce" class="sapUiTinyMarginEnd"/>
                                        <Text id="_IDGenText" text="Period: {view>/periodDisplayText}" class="infoStripText sapUiMediumMarginEnd"/>
                                        
                                        <HBox id="comparisonPeriodBox" visible="{view>/showComparisonPeriod}" alignItems="Center">
                                            <core:Icon id="iconCompare" src="sap-icon://compare" size="0.875rem" color="#718096" class="sapUiTinyMarginEnd"/>
                                            <Text id="txtComparisonPeriod" text="Comparing with: {view>/periodLabelPY}" class="infoStripTextSecondary sapUiMediumMarginEnd"/>
                                        </HBox>
                                        
                                        <core:Icon id="_IDGenIcon2" src="sap-icon://bar-chart" size="1rem" color="#3182ce" class="sapUiTinyMarginEnd"/>
                                        <Text id="_IDGenText1" text="Viewing: {view>/activeMetricLabel}" class="infoStripText"/>
                                    </HBox>
                                </items>
                            </HBox>



<fb:FilterBar id="filterBar" search=".onSearch" showRestoreButton="true" clear=".onResetFilters" class="sapUiSmallMarginBottom">
    <fb:filterGroupItems>
    <fb:FilterGroupItem id="fgiScheme" groupName="G1" name="Scheme" label="Scheme" visibleInFilterBar="true">
                                                    <fb:control>
                                                        <ComboBox id="fbScheme" items="{view>/filterSchemes}" placeholder="Select Scheme" selectionChange=".onSearch">
                                                            <core:Item id="_IDGenItem1" key="{view>key}" text="{view>text}"/>
                                                        </ComboBox>
                                                    </fb:control>
                                                </fb:FilterGroupItem>

                                                <fb:FilterGroupItem id="fgiBorrowerGroup" groupName="G1" name="BorrowerGroup" label="Borrower Group" visibleInFilterBar="true" visible="{view>/showBorrowerGroupFilter}">
                                                    <fb:control>
                                                        <ComboBox id="fbBorrowerGroup" items="{view>/filterBorrowerGroups}" placeholder="Select Borrower Group" selectionChange=".onSearch">
                                                            <core:Item id="_IDGenItem2" key="{view>key}" text="{view>text}"/>
                                                        </ComboBox>
                                                    </fb:control>
                                                </fb:FilterGroupItem>

                                                <fb:FilterGroupItem id="fgiBorrowerName" groupName="G1" name="BorrowerName" label="Borrower Group Name" visibleInFilterBar="true" visible="{view>/showBorrowerNameFilter}">
                                                    <fb:control>
                                                        <ComboBox id="fbBorrowerName" items="{view>/filterBorrowerNames}" placeholder="Select Borrower Name" selectionChange=".onSearch">
                                                            <core:Item id="_IDGenItem3" key="{view>key}" text="{view>text}"/>
                                                        </ComboBox>
                                                    </fb:control>
                                                </fb:FilterGroupItem>

                                                <fb:FilterGroupItem id="fgiDimension" groupName="G1" name="Dimension" label="{view>/filterLabel}" visibleInFilterBar="true" visible="{view>/showDimensionFilter}">
                                                    <fb:control>
                                                        <ComboBox id="fbDimension" items="{view>/filterDimensions}" placeholder="{view>/filterPlaceholder}" selectionChange=".onSearch">
                                                            <core:Item id="_IDGenItem4" key="{view>key}" text="{view>text}"/>
                                                        </ComboBox>
                                                    </fb:control>
                                                </fb:FilterGroupItem>

                                                <fb:FilterGroupItem id="fgiQuickSearch" groupName="G1" name="QuickSearch" label="Search" visibleInFilterBar="true">
                                                    <fb:control>
                                                        <SearchField id="fbQuickSearch" liveChange=".onQuickSearch" placeholder="Search..." width="200px"/>
                                                    </fb:control>
                                                </fb:FilterGroupItem>
        </fb:filterGroupItems>
</fb:FilterBar>

<OverflowToolbar id="globalChartFilterToolbar" visible="{view>/isChartFiltered}" design="Transparent">
    <ToolbarSpacer/>
    <Button id="btnGlobalClear" icon="sap-icon://clear-filter" text="Clear Chart Selection" press=".onClearChartFilter" type="Reject"/>
</OverflowToolbar>

                            <IconTabBar id="tabBar" select=".onTabSelect" expandable="false" stretchContentHeight="true" class="sapUiNoContentPadding">
                                <items>
                                    <!-- DATA TABLE TAB -->
                                    <IconTabFilter id="_IDGenIconTabFilter" key="data" text="Data Table" icon="sap-icon://table-view">
                                        <!-- <fb:FilterBar id="filterBar" search=".onSearch" showRestoreButton="true" clear=".onResetFilters">
                                            <fb:filterGroupItems>
                                                <fb:FilterGroupItem id="fgiScheme" groupName="G1" name="Scheme" label="Scheme" visibleInFilterBar="true">
                                                    <fb:control>
                                                        <ComboBox id="fbScheme" items="{view>/filterSchemes}" placeholder="Select Scheme" selectionChange=".onSearch">
                                                            <core:Item id="_IDGenItem1" key="{view>key}" text="{view>text}"/>
                                                        </ComboBox>
                                                    </fb:control>
                                                </fb:FilterGroupItem>

                                                <fb:FilterGroupItem id="fgiBorrowerGroup" groupName="G1" name="BorrowerGroup" label="Borrower Group" visibleInFilterBar="true" visible="{view>/showBorrowerGroupFilter}">
                                                    <fb:control>
                                                        <ComboBox id="fbBorrowerGroup" items="{view>/filterBorrowerGroups}" placeholder="Select Borrower Group" selectionChange=".onSearch">
                                                            <core:Item id="_IDGenItem2" key="{view>key}" text="{view>text}"/>
                                                        </ComboBox>
                                                    </fb:control>
                                                </fb:FilterGroupItem>

                                                <fb:FilterGroupItem id="fgiBorrowerName" groupName="G1" name="BorrowerName" label="Borrower Group Name" visibleInFilterBar="true" visible="{view>/showBorrowerNameFilter}">
                                                    <fb:control>
                                                        <ComboBox id="fbBorrowerName" items="{view>/filterBorrowerNames}" placeholder="Select Borrower Name" selectionChange=".onSearch">
                                                            <core:Item id="_IDGenItem3" key="{view>key}" text="{view>text}"/>
                                                        </ComboBox>
                                                    </fb:control>
                                                </fb:FilterGroupItem>

                                                <fb:FilterGroupItem id="fgiDimension" groupName="G1" name="Dimension" label="{view>/filterLabel}" visibleInFilterBar="true" visible="{view>/showDimensionFilter}">
                                                    <fb:control>
                                                        <ComboBox id="fbDimension" items="{view>/filterDimensions}" placeholder="{view>/filterPlaceholder}" selectionChange=".onSearch">
                                                            <core:Item id="_IDGenItem4" key="{view>key}" text="{view>text}"/>
                                                        </ComboBox>
                                                    </fb:control>
                                                </fb:FilterGroupItem>

                                                <fb:FilterGroupItem id="fgiQuickSearch" groupName="G1" name="QuickSearch" label="Search" visibleInFilterBar="true">
                                                    <fb:control>
                                                        <SearchField id="fbQuickSearch" liveChange=".onQuickSearch" placeholder="Search..." width="200px"/>
                                                    </fb:control>
                                                </fb:FilterGroupItem>
                                            </fb:filterGroupItems>
                                        </fb:FilterBar> -->

                                        <Table id="_IDGenTable" items="{view>/rows}" sticky="ColumnHeaders,HeaderToolbar" growing="true" growingThreshold="20">
    <!-- <headerToolbar>
        <OverflowToolbar id="_IDGenOverflowToolbarTable">
            <Title id="_IDGenTitleTable" text="Details List"/>
            <ToolbarSpacer id="_IDGenToolbarSpacerTable"/>
            <Button id="btnClearChartFilter" icon="sap-icon://clear-filter" text="Clear Chart Filter" 
                    visible="{view>/isChartFiltered}" press=".onClearChartFilter" type="Transparent"/>
            <Button id="btnSort" icon="sap-icon://sort" press=".onOpenViewSettings" type="Transparent"/>
        </OverflowToolbar>
    </headerToolbar> -->
                                            <columns>
                                              <Column id="_IDGenColumn" width="12rem" hAlign="Begin">
            <header><Text id="_IDGenText2" text="{view>/col1Header}"/></header>
        </Column>
                                                <Column id="_IDGenColumn1" width="10rem"><Text id="_IDGenText4" text="{view>/col2Header}"/></Column>
                                                <Column id="_IDGenColumn2" width="12rem" visible="{view>/showCol3}"><Text id="_IDGenText5" text="{view>/col3Header}"/></Column>
                                                <Column id="_IDGenColumn3" hAlign="End"><Text id="_IDGenText6" text="Projects (CY)"/></Column>
                                                <Column id="_IDGenColumn4" hAlign="End"><Text id="_IDGenText7" text="Cost (CY)"/></Column>
                                                <Column id="_IDGenColumn5" hAlign="End"><Text id="_IDGenText8" text="{view>/activeMetricLabel} (CY)"/></Column>
                                                <Column id="_IDGenColumn6" hAlign="End" visible="{view>/comparisonMode}"><Text id="_IDGenText9" text="Projects (PY)"/></Column>
                                                <Column id="colProjectCostPY" hAlign="End" visible="{view>/comparisonMode}"><Text id="txtProjectCostPY" text="Cost (PY)"/></Column>
                                                <Column id="_IDGenColumn7" hAlign="End" visible="{view>/comparisonMode}"><Text id="_IDGenText10" text="{view>/activeMetricLabel} (PY)"/></Column>
                                                <Column id="_IDGenColumn8" hAlign="End" visible="{view>/comparisonMode}"><Text id="_IDGenText14" text="Proj. Var"/></Column>
                                                <Column id="_IDGenColumn9" hAlign="End" visible="{view>/comparisonMode}"><Text id="_IDGenText15" text="Metric Var"/></Column>
                                                <Column id="_IDGenColumn10" hAlign="End" visible="{view>/comparisonMode}"><Text id="_IDGenText16" text="Var %"/></Column>
                                            </columns>
                                            <items>
                                                <ColumnListItem id="_IDGenColumnListItem">
                                                    <cells>
                                                        <Text id="_IDGenText17" text="{view>DisplayCol1}"/>
                                                        <Text id="_IDGenText18" text="{view>DisplayCol2}"/>
                                                        <Text id="_IDGenText19" text="{view>BorrowerGroupName}"/>
                                                        <ObjectNumber id="_IDGenObjectNumber" number="{view>ProjectsCY}"/>
                                                        <ObjectNumber id="_IDGenObjectNumber1" number="{path: 'view>ProjectCostCY', formatter: '.formatter.metric'}" unit="Cr"/>
                                                        <ObjectNumber id="_IDGenObjectNumber2" number="{path: 'view>MetricCY', formatter: '.formatter.metric'}" unit="Cr" state="Information"/>
                                                        <ObjectNumber id="_IDGenObjectNumber6" number="{view>ProjectsPY}"/>
                                                        <ObjectNumber id="objProjectCostPY" number="{path: 'view>ProjectCostPY', formatter: '.formatter.metric'}" unit="Cr"/>
                                                        <ObjectNumber id="_IDGenObjectNumber7" number="{path: 'view>MetricPY', formatter: '.formatter.metric'}" unit="Cr"/>
                                                        <ObjectNumber id="_IDGenObjectNumber8" number="{view>ProjectsVar}" state="{view>ProjectsVarState}"/>
                                                        <ObjectNumber id="_IDGenObjectNumber9" number="{path: 'view>MetricVar', formatter: '.formatter.metric'}" state="{view>MetricVarState}"/>
                                                        <ObjectNumber id="_IDGenObjectNumber10" number="{path: 'view>MetricVarPct', formatter: '.formatter.percentage'}" unit="%" state="{view>MetricVarState}"/>
                                                    </cells>
                                                </ColumnListItem>
                                            </items>
                                        </Table>
                                    </IconTabFilter>

                                    <!-- ANALYTICS TAB -->
                                    <IconTabFilter id="_IDGenIconTabFilter1" key="analytics" text="Analytics" icon="sap-icon://line-chart">
                                        <VBox id="_IDGenVBox" width="100%" class="sapUiMediumMarginTop">
                                            <items>
                                                <!-- KPI CARDS -->
                                                <HBox id="_IDGenHBox3" width="100%" height="220px" class="sapUiSmallMarginBottom">
                                                    <items>
                                                        <f:Card id="_IDGenCard" class="kpiCard sapUiSmallMarginEnd" width="320px">
                                                            <f:content>
                                                                <VBox id="_IDGenVBox1" height="200px" class="sapUiSmallMargin" justifyContent="SpaceBetween">
                                                                    <items>
                                                                        <VBox id="mainKpiProjects">
                                                                            <Text id="_IDGenText11" text="TOTAL PROJECTS" class="subtleTitle"/>
                                                                            <ObjectNumber id="_IDGenObjectNumber3" number="{view>/totalProjects}" class="bigKpiNumber" state="Success"/>
                                                                        </VBox>
                                                                        <VBox id="deltaProjects" visible="{view>/comparisonMode}" class="deltaContainer">
                                                                            <HBox id="deltaProjRow" alignItems="Center" class="sapUiTinyMarginBottom">
                                                                                <core:Icon id="iconProjDelta" src="{= ${view>/totalProjectsVar} >= 0 ? 'sap-icon://arrow-top' : 'sap-icon://arrow-bottom' }" size="0.9rem" color="{= ${view>/totalProjectsVar} >= 0 ? '#107e3e' : '#bb0000' }"/>
                                                                                <Text id="txtProjDelta" text="{view>/totalProjectsVar} ({view>/totalProjectsVarPct}%)" class="deltaTextLarge"/>
                                                                            </HBox>
                                                                            <Text id="txtProjPY" text="PY ({view>/periodLabelPY}): {view>/totalProjectsPY}" class="pyTextLarge"/>
                                                                        </VBox>
                                                                    </items>
                                                                </VBox>
                                                            </f:content>
                                                        </f:Card>
                                                        
                                                        <f:Card id="_IDGenCard1" class="kpiCard sapUiSmallMarginEnd" width="320px">
                                                            <f:content>
                                                                <VBox id="_IDGenVBox2" height="200px" class="sapUiSmallMargin" justifyContent="SpaceBetween">
                                                                    <items>
                                                                        <VBox id="mainKpiCost">
                                                                            <Text id="_IDGenText12" text="PROJECT COST (SUM)" class="subtleTitle"/>
                                                                            <ObjectNumber id="_IDGenObjectNumber4" number="{path: 'view>/totalProjectCost', formatter: '.formatter.metricCompact'}" class="bigKpiNumber"/>
                                                                        </VBox>
                                                                        <VBox id="deltaCost" visible="{view>/comparisonMode}" class="deltaContainer">
                                                                            <Text id="txtCostPY" text="PY ({view>/periodLabelPY}): {path: 'view>/totalProjectCostPY', formatter: '.formatter.metricCompact'}" class="pyTextLarge"/>
                                                                        </VBox>
                                                                    </items>
                                                                </VBox>
                                                            </f:content>
                                                        </f:Card>
                                                        
                                                        <f:Card id="_IDGenCard2" class="kpiCard" width="320px">
                                                            <f:content>
                                                                <VBox id="_IDGenVBox3" height="200px" class="sapUiSmallMargin" justifyContent="SpaceBetween">
                                                                    <items>
                                                                        <VBox id="mainKpiMetric">
                                                                            <Text id="_IDGenText13" text="{view>/activeMetricLabel}" class="subtleTitle"/>
                                                                            <ObjectNumber id="_IDGenObjectNumber5" number="{path: 'view>/totalMetric', formatter: '.formatter.metricCompact'}" class="bigKpiNumber" state="Information"/>
                                                                        </VBox>
                                                                        <VBox id="deltaMetric" visible="{view>/comparisonMode}" class="deltaContainer">
                                                                            <HBox id="deltaMetricRow" alignItems="Center" wrap="Wrap" class="sapUiTinyMarginBottom">
                                                                                <core:Icon id="iconMetricDelta" src="{= ${view>/totalMetricVar} >= 0 ? 'sap-icon://arrow-top' : 'sap-icon://arrow-bottom' }" size="0.9rem" color="{= ${view>/totalMetricVar} >= 0 ? '#107e3e' : '#bb0000' }"/>
                                                                                <Text id="txtMetricDeltaAmount" text="{path: 'view>/totalMetricVar', formatter: '.formatter.varianceWithSign'} " class="deltaTextLarge"/>
                                                                                <Text id="txtMetricDeltaPct" text="({path: 'view>/totalMetricVarPct', formatter: '.formatter.percentage'}%)" class="deltaTextLarge"/>
                                                                            </HBox>
                                                                            <Text id="txtMetricPY" text="PY ({view>/periodLabelPY}): {path: 'view>/totalMetricPY', formatter: '.formatter.metricCompact'}" class="pyTextLarge"/>
                                                                        </VBox>
                                                                    </items>
                                                                </VBox>
                                                            </f:content>
                                                        </f:Card>
                                                    </items>
                                                </HBox>

                                                <!-- FIXED CHART CONTAINER: VBox to Ensure Full Width -->
                                                <VBox id="chartContainer" width="100%">
                                                    <items>
                                                        <!-- COMPARISON CHART CARD -->
                                                <f:Card id="cardComparison" width="100%" visible="{view>/showComparisonChart}" class="chartCard sapUiSmallMarginBottom">
    <f:header>
        <card:Header id="_IDGenHeader" title="Top 10 Entities: CY vs PY Comparison" subtitle="{view>/activeMetricLabel} (Amount in Cr)" iconSrc="sap-icon://compare"/>
    </f:header>
    <f:content>
        <VBox id="_IDGenVBoxComp" width="100%">
            <Toolbar id="_IDGenToolbarComp" design="Transparent" class="sapUiTinyMarginBottom">
                <ToolbarSpacer id="_IDGenSpacerComp"/>
                <SegmentedButton selectedKey="{view>/compChartType}" selectionChange=".onChartTypeChange">
                    <items>
                        <SegmentedButtonItem key="column" icon="sap-icon://vertical-bar-chart" tooltip="Column Chart"/>
                        <SegmentedButtonItem key="line" icon="sap-icon://line-chart" tooltip="Line Chart"/>
                        <SegmentedButtonItem key="stacked_column" icon="sap-icon://stacked-column-chart" tooltip="Stacked Chart"/>
                    </items>
                </SegmentedButton>
            </Toolbar>
            
            <viz:VizFrame id="vizFrameComp" 
                          vizType="{view>/compChartType}" 
                          selectData=".onChartSelectData" 
                          width="100%" height="450px" uiConfig="{applicationSet:'fiori'}">
                <viz:dataset>
                    <vizData:FlattenedDataset id="_IDGenFlattenedDataset" data="{view>/chartData}">
                        <vizData:dimensions>
                            <vizData:DimensionDefinition name="Dimension" value="{view>Dimension}"/>
                        </vizData:dimensions>
                        <vizData:measures>
                            <vizData:MeasureDefinition name="CY" value="{view>CY}"/>
                            <vizData:MeasureDefinition name="PY" value="{view>PY}"/>
                        </vizData:measures>
                    </vizData:FlattenedDataset>
                </viz:dataset>
                <viz:feeds>
                    <vizFeeds:FeedItem uid="valueAxis" type="Measure" values="CY,PY"/>
                    <vizFeeds:FeedItem uid="categoryAxis" type="Dimension" values="Dimension"/>
                </viz:feeds>
           
    
  
</viz:VizFrame>
        </VBox>
    </f:content>
</f:Card>

                                                        <!-- TREND CHART CARD -->
<!-- TREND CHART CARD -->
<f:Card id="cardTrend" width="100%" visible="{= !${view>/showComparisonChart} }" class="chartCard sapUiSmallMarginBottom">
    <f:header>
        <!-- REMOVED THE INVALID TOOLBAR FROM HEADER -->
        <card:Header id="_IDGenHeader1" title="Top 10 Entities: {view>/activeMetricLabel}" subtitle="{view>/activeMetricLabel} (Cr)" iconSrc="sap-icon://compare"/>
    </f:header>
    <f:content>
        <!-- MOVED TOOLBAR INSIDE CONTENT (Wrapped in VBox with VizFrame) -->
        <VBox>
            <Toolbar design="Transparent" class="sapUiTinyMarginBottom">
                <ToolbarSpacer/>
                <SegmentedButton selectedKey="{view>/trendChartType}" selectionChange=".onChartTypeChange">
                    <items>
                        <SegmentedButtonItem key="column" icon="sap-icon://vertical-bar-chart" tooltip="Column Chart"/>
                        <SegmentedButtonItem key="line" icon="sap-icon://line-chart" tooltip="Line Chart"/>
                        <SegmentedButtonItem key="stacked_column" icon="sap-icon://stacked-column-chart" tooltip="Stacked Chart"/>
                    </items>
                </SegmentedButton>
            </Toolbar>
            
            <viz:VizFrame id="vizFrameTrend" 
                vizType="{view>/trendChartType}" 
                selectData=".onChartSelectData" 
                width="100%" height="450px" uiConfig="{applicationSet:'fiori'}">
                <viz:dataset>
                    <vizData:FlattenedDataset id="_IDGenFlattenedDataset1" data="{view>/chartData}">
                        <vizData:dimensions>
                            <vizData:DimensionDefinition id="_IDGenDimensionDefinition1" name="Dimension" value="{view>Dimension}"/>
                        </vizData:dimensions>
                        <vizData:measures>
                            <vizData:MeasureDefinition id="_IDGenMeasureDefinition3" name="Value" value="{view>Value}"/>
                        </vizData:measures>
                    </vizData:FlattenedDataset>
                </viz:dataset>
                <viz:feeds>
                    <vizFeeds:FeedItem id="_IDGenFeedItem2" uid="valueAxis" type="Measure" values="Value"/>
                    <vizFeeds:FeedItem id="_IDGenFeedItem3" uid="categoryAxis" type="Dimension" values="Dimension"/>
                </viz:feeds>
            </viz:VizFrame>
        </VBox>
    </f:content>
</f:Card>

                                                        <!-- WATERFALL CHART -->
                                                        <f:Card id="cardWaterfall" width="100%" visible="{view>/showComparisonChart}" class="chartCard sapUiSmallMarginBottom">
                                                            <f:header>
                                                                <card:Header id="hdrWaterfall" title="Variance Waterfall: PY to CY" subtitle="Top 5 Increases and Decreases" iconSrc="sap-icon://waterfall-chart"/>
                                                            </f:header>
                                                            <f:content>
                                                                <viz:VizFrame id="vizWaterfall" vizType="waterfall" width="100%" height="450px" uiConfig="{applicationSet:'fiori'}">
                                                                    <viz:dataset>
                                                                        <vizData:FlattenedDataset id="fdsWaterfall" data="{view>/waterfallData}">
                                                                            <vizData:dimensions>
                                                                                <vizData:DimensionDefinition id="dimWaterfall" name="Category" value="{view>Category}"/>
                                                                                <vizData:DimensionDefinition id="dimWaterfallType" name="Type" value="{view>Type}"/>
                                                                            </vizData:dimensions>
                                                                            <vizData:measures>
                                                                                <vizData:MeasureDefinition id="measWaterfall" name="Value" value="{view>Value}"/>
                                                                            </vizData:measures>
                                                                        </vizData:FlattenedDataset>
                                                                    </viz:dataset>
                                                                    <viz:feeds>
                                                                        <vizFeeds:FeedItem id="feedWaterfallVal" uid="valueAxis" type="Measure" values="Value"/>
                                                                        <vizFeeds:FeedItem id="feedWaterfallCat" uid="categoryAxis" type="Dimension" values="Category"/>
                                                                        <vizFeeds:FeedItem id="feedWaterfallType" uid="waterfallType" type="Dimension" values="Type"/>
                                                                    </viz:feeds>
                                                                </viz:VizFrame>
                                                            </f:content>
                                                        </f:Card>
                                                    </items>
                                                </VBox>
                                            </items>
                                        </VBox>
                                    </IconTabFilter>

                                    <!-- GEO TAB -->
                                    <IconTabFilter id="_IDGenIconTabFilter2" key="geo" text="Geographical" icon="sap-icon://map" visible="{view>/isGeoReport}">
                                        <HBox id="_IDGenHBox4" width="100%" height="750px" alignItems="Stretch" class="sapUiMediumMarginTop">
                                            <items>
                                                <VBox id="_IDGenVBox4" width="65%" height="100%" class="mapContainerBox">
                                                    <items>
                                                        <core:HTML id="_IDGenHTML" content='&lt;div id="indiaMapContainer" class="indiaMapWrapper"&gt;&lt;/div&gt;'/>
                                                    </items>
                                                </VBox>
                                                <VBox id="_IDGenVBox5" width="33%" class="sapUiSmallMarginBegin">
                                                    <items>
                                                        <f:Card id="_IDGenCard5" class="chartCard">
                                                            <f:header>
                                                                <card:Header id="_IDGenHeader2" title="Regional Distribution" subtitle="Amount by Zone" iconSrc="sap-icon://choropleth-chart"/>
                                                            </f:header>
                                                            <f:content>
                                                                <viz:VizFrame id="geoVizFrame" vizType="bar" width="100%" height="650px">
                                                                    <viz:dataset>
                                                                        <vizData:FlattenedDataset id="_IDGenFlattenedDataset2" data="{geoData>/items}">
                                                                            <vizData:dimensions>
                                                                                <vizData:DimensionDefinition id="_IDGenDimensionDefinition2" name="Zone" value="{geoData>Zone}"/>
                                                                            </vizData:dimensions>
                                                                            <vizData:measures>
                                                                                <vizData:MeasureDefinition id="_IDGenMeasureDefinition2" name="Value" value="{geoData>Value}"/>
                                                                            </vizData:measures>
                                                                        </vizData:FlattenedDataset>
                                                                    </viz:dataset>
                                                                    <viz:feeds>
                                                                        <vizFeeds:FeedItem id="_IDGenFeedItem5" uid="valueAxis" type="Measure" values="Value"/>
                                                                        <vizFeeds:FeedItem id="_IDGenFeedItem6" uid="categoryAxis" type="Dimension" values="Zone"/>
                                                                    </viz:feeds>
                                                                </viz:VizFrame>
                                                            </f:content>
                                                        </f:Card>
                                                    </items>
                                                </VBox>
                                            </items>
                                        </HBox>
                                    </IconTabFilter>
                                </items>
                            </IconTabBar>
                        </items>
                    </VBox>
                </HBox>
            </content>
        </Page>
     </App>
</mvc:View>
 